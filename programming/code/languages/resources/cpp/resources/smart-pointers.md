# smart pointers are ‚Ä¶

> –î–∞–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç–Ω—ã–º —Å–ª—É—á–∞–µ–º –∏–¥–∏–æ–º—ã **RAII**. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ —Å—Ç–æ–∏—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ–¥ –Ω–∏–º–∏, –∞ —Ç–∞–∫–∂–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ –ø–æ–¥ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç. –ù–µ –≤—Å–µ–≥–¥–∞ –ø–æ–Ω—è—Ç–Ω–æ –∏–∑–≤–Ω–µ, –∫—Ç–æ –∏–º–µ–Ω–Ω–æ –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥—è—â–µ–≥–æ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–∞ –∏ —Ç.–¥. –∏ —Ç.–ø. –î–ª—è –±–æ—Ä—å–±—ã —Å —Ç–∞–∫–∏–º–∏ –Ω—é–∞–Ω—Å–∞–º–∏ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –æ–±—ë—Ä—Ç–∫–∞ —Å–º–∞—Ä—Ç-—É–∫–∞–∑–∞—Ç–µ–ª–µ–π.
> 

–û–±—â–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–º–∞—Ä—Ç —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –æ–±—ä–µ–∫—Ç, –Ω–∞—Ö–æ–¥—è—â–∏–π—Å—è –ø–æ–¥ —Ç–∞–∫–∏–º —É–∫–∞–∑–∞—Ç–µ–ª–µ–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–º, —Ç.–µ. —Å–º–∞—Ä—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–±–ª–∞–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ ‚Äú—É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏‚Äù. –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –ø–æ–¥ —Ç–∞–∫–∏–º —É–∫–∞–∑–∞—Ç–µ–ª–µ–º —É–Ω–∏—á—Ç–æ–∂–∏—Ç—Å—è, —Ç–æ –∏ —Ç–∞–∫–æ–π —É–∫–∞–∑–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç –Ω–∞ —á—Ç–æ –ª–∏–±–æ —É–∫–∞–∑—ã–≤–∞—Ç—å (–æ–±—ã—á–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å –∂–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç), –µ—Å–ª–∏ —Ç–∞–∫–æ–π —É–∫–∞–∑–∞—Ç–µ–ª—å —É–¥–∞–ª–∏—Ç—Å—è, —Ç–æ –æ–±—ä–µ–∫—Ç –ø–æ–¥ –Ω–∏–º —Ç–æ–∂–µ –∏—Å—á–µ–∑–Ω–µ—Ç –∏–∑ –ø–∞–º—è—Ç–∏. –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ –ø–æ–¥ —Ç–∞–∫–∏–º —É–∫–∞–∑–∞—Ç–µ–ª–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–æ–≤ —Å–º–∞—Ä—Ç-—É–∫–∞–∑–∞—Ç–µ–ª–µ–π:

# std::unique_ptr

> –£–º–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å, –≤–ª–∞–¥–µ—é—â–∏–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–æ–º. –û–Ω –≤–æ–ø–ª–æ—â–∞–µ—Ç –ø—Ä—è–º –∏–¥–µ—é, —á—Ç–æ –æ–¥–∏–Ω —É–∫–∞–∑–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–µ—Ç –æ–¥–Ω–∏–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º. –ü–æ –ø–µ—Ä—Ñ–æ–º–∞–Ω—Å—É –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º —Å –æ–±—ã—á–Ω—ã–º —É–∫–∞–∑–∞—Ç–µ–ª–µ–º (–¢*)
> 

```cpp
std::unique_ptr<int>    p1 = std::make_unique<int>();
std::unique_ptr<int[]>  p2 = std::make_unique<int[]>(50);
std::unique_ptr<Object> p3 = std::make_unique<Object>("Lamp");
```

```cpp
struct MyDeleter { // –°–æ–∑–¥–∞–Ω–∏–µ "–∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ" —É–¥–∞–ª–µ–Ω–∏—è
    void operator()(int* ptr) {
        std::cout << "Custom Deleter: Deleting pointer" << std::endl;
        delete ptr;
    }
};

int main() {
    std::unique_ptr<int, MyDeleter> p1(new int(5), MyDeleter());
    return 0; // Custom Deleter will be called when p1 goes out of scope
}
```

# std::shared_ptr

> –£–º–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å, –≤–ª–∞–¥–µ—é—â–∏–π —Ä–∞–∑–¥–µ–ª—è–µ–º—ã–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–æ–º. –ù–µ—Å–∫–æ–ª—å–∫–æ std::shared_ptr –º–æ–≥—É—Ç –≤–ª–∞–¥–µ—Ç—å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ —Ä–µ—Å—É—Ä—Å–æ–º, –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å—á–µ—Ç—á–∏–∫ –≤–µ–¥–µ—Ç –∏—Ö —É—á–µ—Ç. –ö–æ–≥–¥–∞ –∫–æ–ª-–≤–æ –æ–±–ª–∞–¥–∞—Ç–µ–ª–µ–π –æ–±—ä–µ–∫—Ç–æ–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ä–∞–≤–Ω—ã–º 0, —Ç–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è. –ü–æ –ø–µ—Ä—Ñ–æ–º–∞–Ω—Å—É –æ—â—É—Ç–∏–º–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–±—ã—á–Ω–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è + –¥–æ–≤–æ–ª—å–Ω–æ —Ç–æ–ª—Å—Ç—ã–π –∏–∑-–∑–∞ –Ω–∞–ª–∏—á–∏—è —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ –±–ª–æ–∫–∞ (–ø–æ–¥—Å—á—ë—Ç–∞ —Å—Å—ã–ª–æ–∫).
> 

```cpp
std::shared_ptr<int>    p1 = std::make_shared<int>();
std::shared_ptr<Object> p2 = std::make_shared<Object>("Lamp");
```

```cpp
void compute()
{
  std::shared_ptr<int> ptr = std::make_shared<int>(100);
  // ptr.use_count() == 1
  std::shared_ptr<int> ptr_copy = ptr;   // –°–¥–µ–ª–∞—Ç—å –∫–æ–ø–∏—é: —Å shared_ptr –≤–æ–∑–º–æ–∂–Ω–æ!
  // ptr.use_count() == 2
  // ptr_copy.use_count() == 2, –≤ –∫–æ–Ω—Ü–µ –∫–æ–Ω—Ü–æ–≤, —ç—Ç–æ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.
} // –ó–¥–µ—Å—å `ptr` –∏ `ptr_copy` –≤—ã—Ö–æ–¥—è—Ç –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è. –ë–æ–ª—å—à–µ –Ω–∏–∫–∞–∫–∏—Ö —Å—Å—ã–ª–æ–∫  
  // –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç.–µ. use_count() == 0), –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–±–∏—Ä–∞—é—Ç—Å—è.
int main()
{
  compute();
}
```

## Control block

> –î–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Ä–µ—Å—É—Ä—Å —è–≤–Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–∞–∫–æ–π-—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ö–∞–Ω–∏–∑–º‚Ä¶ –í–ª–∞–¥–µ—é—â–∏–µ —Ä–µ—Å—É—Ä—Å–æ–º –æ–±—ä–µ–∫—Ç—ã¬†shared_ptr¬†—Å–æ–≤–º–µ—Å—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –±–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–µ–µ:
> 
- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤¬†shared_ptr, –≤–ª–∞–¥–µ—é—â–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–º;
- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤¬†shared_ptr, —É–∫–∞–∑—ã–≤–∞—é—â–∏—Ö –Ω–∞ —Ä–µ—Å—É—Ä—Å;
- –º–µ—Ç–æ–¥ —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å;
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è –±–ª–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å.

## std::shared_ptr<>() vs std::make_shared<>()

–í –¥–∞–≤–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∞, –∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–æ CTAD‚Äô–∞, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞–ø–ª–æ–¥–∏–ª–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ make-–º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤, —Å –°++17 –∏ –µ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏–µ–º –º–Ω–æ–≥–æ–µ –≤ –ø–ª–∞–Ω–µ —à–∞–±–ª–æ–Ω–æ–≤ —Å—Ç–∞–ª–æ –ª—É—á—à–µ‚Ä¶ 

```cpp
void DoSth(std::shared_ptr<CoolType>(new CoolType(true)
           int a,
           std::function<void()> handler) {...}
```

–í –°++ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —Å–ø–æ–∫–æ–π–Ω–æ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –¥–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ, —Ä–∞–∑–≤–µ —á—Ç–æ new CoolType –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π shared_ptr.
–î–æ–ø—É—Å—Ç–∏–º, —á—Ç–æ –±—É–¥–µ—Ç —Ç–∞–∫–æ–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–æ–≤:

- new CoolType
- int a
- handler
- std::shared_ptr‚Ä¶

–¢–µ–ø–µ—Ä—å —Ç–∞–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è, —á—Ç–æ handler –≤—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.. new CoolType –±—ã–ª —Å–æ–∑–¥–∞–Ω –Ω–∞ –∫—É—á–µ —Ä–∞–Ω–µ–µ, –∞ shared_ptr –µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏–ª.. —É—Ç–µ—á–∫–∞‚Ä¶ **–¢.–µ. –≤ shared_ptr –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–ª–ª–æ–∫–∞—Ü–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ–±—ä–µ–∫—Ç–∞ –∏ –æ—Ç–¥–µ–ª—å–Ω–æ —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ –±–ª–æ–∫–∞ ‚Üí —Ç.–µ. –∏—Ö 2.**
–î–ª—è —Ç–∞–∫–æ–≥–æ —Ä–∞–Ω–µ–µ –∫–∞–∫ —Ä–∞–∑ –±—ã–ª –±—ã –ø–æ–ª–µ–∑–µ–Ω –º–µ—Ç–æ–¥ –ø–æ —Ç–∏–ø—É **std::make_shared<>(), –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ä–∞–∑—É –∏ –æ–±—ä–µ–∫—Ç –∏ —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –±–ª–æ–∫ –¥–ª—è –Ω–µ–≥–æ ‚Üí –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–∏—à—å 1 –∞–ª–ª–æ–∫–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–∞** 

<aside>
üí° –í 17 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ —Ç–∞–∫–æ–µ –ø–æ—Ñ–∏–∫—Å–∏–ª–∏ –∏ —Ç–µ–ø–µ—Ä—å —ç—Ç–æ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞. –í–æ–∑–º–æ–∂–Ω–æ, —á—Ç–æ make_shared —Ç–µ–ø–µ—Ä—å –¥–∞–∂–µ –º–µ–¥–ª–µ–Ω–Ω–µ–µ shared_ptr. –¢–∞–∫–∂–µ, –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –±–ª–æ–∫ –∂–∏–≤—ë—Ç, –ø–æ–∫–∞ –µ—Å—Ç—å weak_ptr, –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–∞–∫–∏–º –º–µ—Ç–æ–¥–æ–º –±—É–¥–µ—Ç –∂–∏—Ç—å –Ω–µ—è–≤–Ω–æ, –ø–æ–∫–∞ –µ—Å—Ç—å weak_ptr, –≤–µ–¥—å –æ–Ω –±—ã–ª —Å–æ–∑–¥–∞–Ω –≤–º–µ—Å—Ç–µ —Å —É–ø—Ä–∞–≤–ª—è—é—â–∏–º –±–ª–æ–∫–æ–º —á–µ—Ä–µ–∑ make_shared.

</aside>

## shared_from_this (since C++11)

> –§–∏—á–∞ –∏–∑ STL (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –±—ã–ª–∞ –≤ boost), –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –∫–ª–∞—Å—Å—É –¥–µ–ª–∞—Ç—å shared_ptr –Ω–∞ —Å–∞–º–æ–≥–æ —Å–µ–±—è
> 

[https://en.cppreference.com/w/cpp/memory/enable_shared_from_this](https://en.cppreference.com/w/cpp/memory/enable_shared_from_this)

<aside>
üí° –ï—Å–ª–∏ –∫–ª–∞—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è share_from_this(), —Ç–æ –æ–±—ä–µ–∫—Ç —Ç–∞–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Å –ø–æ–º–æ—â—å—é shared_ptr, –∏–Ω–∞—á–µ –≤—ã–ª–µ—Ç–∏—Ç bad_weak_ptr. –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–µ–º –¥—Ä—É–≥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ —Å –ø–æ–º–æ—â—å—é shared_ptr, —Ç–æ —ç—Ç–æ –Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–¥–æ –±—ã—Ç—å —Å–∞–º–æ–º—É —è–≤–Ω–æ –ø–æ–¥ shared_ptr

</aside>

**tricks:**

```cpp
// Fabric method
class Ttt 
{
	private: 
		Ttt() {};
		
	public:
		static std::shared_ptr<Ttt> Create()
		{
			return shared_from_this();
		}
}

// Expanding object lifetime
auto func_that_will_invoke_after_operation_complete =
	[lifetime = shared_from_this()] {};
	
async_read(any_socket_to_read_from, 
           any_flags, 
           func_that_will_invoke_after_operation_complete);
					 // gurantee that we will be alive until operation is done
```

# std::weak_ptr

> –ü–æ–¥–æ–±–µ–Ω std::shared_ptr, –Ω–æ –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫. Weak_ptr —Ç–∞–∫–∂–µ –Ω–µ –æ–±–ª–∞–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç–æ–º. –û–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã, —á—Ç–æ 2 shared_ptr –º–æ–≥—É—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞, —Ç.–µ. –∏—Ö —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç weak_ptr, –µ—Å–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –æ–¥–∏–Ω –∏–∑ shared_ptr –Ω–∞ weak, —Ç–æ –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–Ω–æ–µ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ —Å—Ç–∞–Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º.
> 

<aside>
üí° –í shared_ptr –±—ã–ª–∞ —Ä–µ—á—å –ø—Ä–æ —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –±–ª–æ–∫‚Ä¶ —Ç–∞–∫ –≤–æ—Ç, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ weak_ptr —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞, —Ç.–∫. –µ–º—É –Ω–∞–¥–æ –∫–∞–∫-—Ç–æ –ø–æ–Ω–∏–º–∞—Ç—å, –∂–∏–≤ –æ–±—ä–µ–∫—Ç –∏–ª–∏ –Ω–µ—Ç

</aside>

```cpp
std::shared_ptr<int> p_shared = std::make_shared<int>(100);
std::weak_ptr<int>   p_weak1(p_shared);
std::weak_ptr<int>   p_weak2(p_weak1);
```

```cpp
//–ò–º–µ–µ—Ç—Å—è –∫–ª–∞—Å—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
struct Component: 
    public std::enable_shared_from_this<Component>
{   //–ö–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —É–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞
    std::vector<std::shared_ptr<Component>> children;//–¥–æ—á–µ—Ä–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    std::shared_ptr<Component> parent;//–∏ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è

    void add(std::shared_ptr<Component> v) 
    {
        children.push_back(std::move(v));
        children.back()->parent = shared_from_this();
    }
    Component()
    { 
        std::cout << "Component::Component()" << std::endl; 
    }
    ~Component() 
    { 
        std::cout << "Component::~Component()" << std::endl; 
    }
};

int main()
{
    std::shared_ptr<Component> component1 = std::make_shared<Component>();
    std::shared_ptr<Component> component2 = std::make_shared<Component>();
    component1->add(std::move(component2));
}
// —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –æ–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –ø–æ–º–µ–Ω—è—Ç—å
// std::shared_ptr<Component> parent; 
// –Ω–∞ std::weak_ptr<Component> parent; 
// —Ç–æ –≤—Å—ë –±—É–¥–µ—Ç —É–¥–∞–ª—è—Ç—å—Å—è
```

# std::auto_ptr (NEVER USE IT)

> –£–º–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å –¥—Ä–µ–≤–Ω–∏—Ö –≤—Ä–µ–º—ë–Ω, –Ω–µ —Å—Ç–æ–∏—Ç –µ–≥–æ –±–æ–ª–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å‚Ä¶ —É –Ω–µ–≥–æ –±—ã–ª –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã–π –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –º–µ—Ö–∞–Ω–∏–∑–º, –Ω–∞–∑—ã–≤–∞–µ–º—ã–π *—Ä–∞–∑—Ä—É—à–∞—é—â–∏–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º,* –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±–ª–∞–¥–∞—Ç—å –æ–¥–Ω–∏–º –æ–±—ä–µ–∫—Ç–æ–º –¥–≤—É–º—è —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤—ã—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π, —á—Ç–æ –∫–æ—Å–≤–µ–Ω–Ω–æ –ø—Ä–æ–≤–æ—Ü–∏—Ä–æ–≤–∞–ª–æ –¥–≤–æ–π–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞. –î–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ delete —Ç–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ, –æ–¥–Ω–∞–∫–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ - –æ—á–µ–Ω—å –¥–∞–∂–µ. unique_ptr –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏–ª —Ç–∞–∫–æ–µ.
>
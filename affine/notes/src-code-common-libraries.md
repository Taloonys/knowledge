---
tags: [code, common]
aliases: [Static library]
---

> **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞** - –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –≤–∏–¥–∞ —Å–±–æ—Ä–Ω–∏–∫ –æ–±—ä–µ–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä –∫–∞–∫ –∞—Ä—Ö–∏–≤ `*.o` —Ñ–∞–π–ª–æ–≤)
# Static library
> –ö–æ–≥–¥–∞ –º—ã —Å–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É, —Ç–æ –º—ã –ø—Ä–æ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∞—Ä—Ö–∏–≤ –æ–±—ä–µ–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä) `.lib`.
> –í–µ—Å—å –Ω–∞—à –∫–æ–¥ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏, –µ—Å–ª–∏ –µ–≥–æ –º–Ω–æ–≥–æ, —Ñ–∞–π–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –±–æ–ª—å—à–æ–π...

–§–æ—Ä–º–∞—Ç—ã –ª–∏–±:
* Windows ‚Üí `.lib` -> *library*
* Linux ‚Üí `.a` -> *archive*
## Linking
* –£ –Ω–∞—Å –µ—Å—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, `exe`, –º—ã –µ–≥–æ —Ö–æ—Ç–∏–º —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å
* –õ–∏–Ω–∫—É–µ–º—Å—è —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –ª–∏–±–æ–π
* –í–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –ª–∏–Ω–∫–æ–≤–∫–∏ –æ–±—ä—è—Å–Ω—è–µ—Ç—Å—è —Ç–µ–º, —á—Ç–æ –≤—Å–µ –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä—è–º –≤—à–∏–≤–∞—é—Ç—Å—è/–≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –Ω–∞—à `exe` –ø—Ä—è–º –≤ —Ç–∞–∫–æ–º –∂–µ –≤–∏–¥–µ
* –¢–∞–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –æ—á–µ–≤–∏–¥–Ω–æ, –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–∑–º–µ—Ä `exe`
* –†–æ–≤–Ω–æ —Ç–∞–∫–∂–µ –º—ã –º–æ–∂–µ–º –≤—à–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –ª–∏–±—É –≤ dll.
# Dynamic library
> –ö–æ–≥–¥–∞ –º—ã —Å–æ–±–∏—Ä–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É, —Ç–æ –≤–µ—Å—å –Ω–∞—à –∫–æ–¥, —É—Å–ª–æ–≤–Ω–æ, –¥–µ–ª–∏—Ç—Å—è –Ω–∞ IAT (Import Address Table) –∏ —Å–∞–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä) `.dll`.
> –°–º—ã—Å–ª —ç—Ç–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ –∏–Ω–∂–µ–∫—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É –ø—Ä—è–º–æ –≤–æ—Ç –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∞ –Ω–µ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ (–∫–∞–∫ —Å–æ —Å—Ç–∞—Ç–∏–∫. –ª–∏–±–æ–π)
## Linking
### Windows
* DLL —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∏–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö -> **—Å–∏–º–≤–æ–ª—ã**
* –í DLL —Å–∏–º–≤–æ–ª—ã –ª–µ–∂–∞—Ç –≤ PE-–∑–∞–≥–æ–ª–æ–≤–∫–µ, PE - Portable Executable
* –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã–≥–ª—è–¥—è—Ç —Ñ–∞–π–ª—ã DLL –∏ –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è **—Ñ–æ—Ä–º–∞—Ç–æ–º PE**: https://learn.microsoft.com/en-us/windows/win32/debug/pe-format
* –í DLL —Ç–∞–∫–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ -> **Export Directory**
* –õ–∏–Ω–∫–æ–≤–∫–∞ –≤ exe -> –≤ exe –ø–æ–ø–∞–¥–∞–µ—Ç **IAT**; IAT –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –ø–æ –∫–∞–∫–æ–º—É –∞–¥—Ä–µ—Å—É –∏—Å–∫–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
* –¢–∞–±–ª–∏—Ü–∞ IAT –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∞–¥—Ä–µ—Å–∞–º–∏ –≤ run-time, –æ–Ω–∏ –±—É–¥—É—Ç –≤—ã–≥—Ä—É–∂–µ–Ω—ã –∫–∞–∫ —Ä–∞–∑ –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π DLL
* –ó–∞–≥—Ä—É–∑—á–∏–∫ Windows, `ldr`, –∫–∞–∫ —Ä–∞–∑ —Å–¥–µ–ª–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —ç—Ç–æ–π DLL
#### Import library
> –≠—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º windows, –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–π DLL –Ω–∞ –≤—ã—Ö–æ–¥–µ `.lib` —Ñ–∞–π–ª—ã. –≠—Ç–∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã, —É—Å–ª–æ–≤–Ω–æ, —Å–ª—É–∂–∞—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ load lib + get proc –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
* –í—Ä—É—á–Ω—É—é —ç—Ç–æ –¥–µ–ª–∞—é—Ç –≤–æ—Ç —Ç–∞–∫, –Ω–æ —Ç–∞–∫–æ–µ —Ç–æ–ª—å–∫–æ –¥–ª—è 1 —Ñ—É–Ω–∫—Ü–∏–∏:
```cpp
//
// –ì–æ–≤–æ—Ä–∏–º, –≥–¥–µ –∏—Å–∫–∞—Ç—å –ª–∏–±—É –∏ –ø–æ–ª—É—á–∞–µ–º –Ω–∞ –Ω–µ—ë handle
//
auto hGetProcIDDLL = LoadLibrary("C:\\SomeWhere\\test.dll");

//
// –í—ã–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∞–¥—Ä–µ—Å—Å —Ñ—É–Ω–∫—Ü–∏–∏, –∏–º—è –∫–æ—Ç–æ—Ä–æ–π —É–∫–∞–∑–∞–Ω–æ –≤ .dll
//
auto funci = (f_funci)GetProcAddress(hGetProcIDDLL, "funci");

//
// –ü–æ–ª—å–∑—É–µ–º—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π...
//
funci();
```
* –≠—Ç–æ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –≤–æ–∑–º–æ–∂–µ–Ω –≤ –≤–∏–Ω–¥–µ, –Ω–æ –æ–Ω –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –µ—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–∫—Å–ø–æ—Ä—Ç–∞, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å –±–µ–∑ –Ω–µ–≥–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –º–∞–Ω–≥–ª–∏–Ω–≥–∞ `__declspec(dllexport)`)
	* mangle - `add(int, int)` -> `__Z3addii`
### Linux
> –ù–∞ —Ñ–æ–Ω–µ windows...
* –í—Å–µ —Å–∏–º–≤–æ–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è —Ç–∞–∫–∂–µ –≤ `.so` –∏ –≤ —Å–µ–∫—Ü–∏–∏ **ELF** (Executable and Linkable Format)
* –í exe –ø–æ–ø–∞–¥–∞–µ—Ç **PLT** (Procedure Linkage Table)
* –ó–∞–≥—Ä—É–∑—á–∏–∫–æ–º —è–≤–ª—è–µ—Ç—Å—è `ld.so`
* –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø. —Ñ–∞–π–ª–æ–≤ (–∫–∞–∫ import library) –ª–∏–Ω—É–∫—Å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –≤—Å—è –Ω—É–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –≤ `.so` –∏ `ELF`

–§–æ—Ä–º–∞—Ç—ã –ª–∏–±:
* Windows ‚Üí `.dll` -> *dynamic link library*
* Linux ‚Üí `.so` -> *shared object*
	* –≤–æ–∑–º–æ–∂–Ω–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä—è–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ -> `libfoo.so.1`, `libfoo.so.1.4`
### CRT
> –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –° –∏ –°++. –û–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–≥—Ä–æ–º–Ω—É—é —á–∞—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Å–∞–º–∏—Ö —ç—Ç–∏—Ö —è–∑—ã–∫–æ–≤. –î–∞–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –µ—Å—Ç—å –Ω–∞ –≤—Å–µ—Ö –û–°, –∏ –Ω–∞–ø–∏—Å–∞–Ω–∞ –æ–Ω–∞ –≤–µ–∑–¥–µ –ø–æ-—Ä–∞–∑–Ω–æ–º—É.

–í—Å—è–∫–∏–µ alloc –∏ maloc –≤ –° –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ, –Ω–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –¥–ª—è –∫–∞–∂–¥–æ–π –û–° –æ–Ω–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ-—Ä–∞–∑–Ω–æ–º—É.. –∫–∞–∫ –ø—Ä–∏–º–µ—Ä, –Ω–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ CRT.

üí° –î–ª—è –∫–∞–∂–¥–æ–π –û–° —Ç–æ–∂–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω–æ —Ä–∞–∑–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–±–æ—Ä–∫–∏ —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ —ç—Ç–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

| –§–ª–∞–∂–æ–∫ –¥–ª—è —Å–±–æ—Ä–∫–∏ | –¢–∏–ø —Å–±–æ—Ä–∫–∏                                    |
| ----------------- | --------------------------------------------- |
| /MT               | Multi Thread / Static Lib / Release buildtype |
| /MTd              | Multi Thread / Static Lib / Debug buildtype   |
| /MD               | Multi Thread / Dynamic Lib / Release build    |
| /MDd              | Multi Thread / Dynamic Lib / Debug build      |
| /LD               | Dynamic lib / Release build                   |
| /LDr              | Dynamic lib / Release build                   |